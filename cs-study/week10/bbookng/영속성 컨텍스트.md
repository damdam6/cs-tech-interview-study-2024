### ğŸ’¡ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€ ?
![img](https://velog.velcdn.com/images/zxzz45/post/c6435938-db08-4ecf-afb6-6d7880fb3393/image.png)
- ORMì€ ê°ì²´ì™€ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë§¤í•‘ì„ í†µí•´ ì—”í‹°í‹° í´ë˜ìŠ¤ ê°ì²´ ì•ˆì— í¬í•¨ëœ ì •ë³´ë¥¼ í…Œì´ë¸”ì— ì €ì¥í•˜ëŠ” ê¸°ìˆ 
- JPA ì—ì„œëŠ” í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ì—”í‹°í‹° ê°ì²´ ì •ë³´ë¥¼ **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸**ë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì—ì„œ ì˜¤ë˜ ì§€ì†ë˜ë„ë¡ ë³´ê´€í•œë‹¤. 
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì— ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ëŠ” í™˜ê²½ 
- ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì¡°íšŒí•˜ë©´ ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì¸í‹°í‹°ë¥¼ ë³´ê´€í•˜ê³  ê´€ë¦¬í•œë‹¤. 

##### âœ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” JPAë¥¼ ì´í•´í•˜ëŠ”ë° ê°€ì¥ ì¤‘ìš”í•œ ìš©ì–´ì´ë‹¤.
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë…¼ë¦¬ì ì¸ ê°œë…
- ëˆˆì— ë³´ì´ì§€ ì•ŠìŒ
- ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼
	- ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ì—¬ DBì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒìœ¼ë¡œ Treansaction ì´ ìˆ˜í–‰ë  ë•Œë§ˆë‹¤ ìƒì„±ëœë‹¤. 
	- ì¦‰, ìŠ¤ë ˆë“œ(ì‚¬ìš©ì ìš”ì²­) ë§ˆë‹¤ í•˜ë‚˜ì˜ ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ìˆê³  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìˆê³ , ìš”ì²­ë§ˆë‹¤ ê³µìœ í•˜ë©´ ì•ˆ ëœë‹¤.

##### âœ” ì˜ì† ê°ì²´
- ì—”í‹°í‹° ê°ì²´ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“¤ì–´ì™€ JPAì˜ ê´€ë¦¬ ëŒ€ìƒì´ ë˜ëŠ” ì‹œì ë¶€í„° í•´ë‹¹ ê°ì²´ë¥¼ **ì˜ì† ê°ì²´**ë¼ê³  ë¶€ë¦„. 

### ğŸ’¡ ì—”í‹°í‹°ì˜ ìƒëª… ì£¼ê¸°
![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb6Csm8%2FbtrR8yFlZvk%2F9JK0yUkShKwgIBTFTwAvak%2Fimg.png)

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” **ì„¸ì…˜ ë‹¨ìœ„ì˜ ìƒëª…ì£¼ê¸°** ë¥¼ ê°€ì§„ë‹¤.
> ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì„¸ì…˜ì´ ìƒì„±ë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ë§Œë“¤ì–´ì§€ê³ , ì„¸ì…˜ì´ ì¢…ë£Œë˜ë©´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë„ ì—†ì–´ì§„ë‹¤. 
> ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì´ëŸ¬í•œ ì¼ë ¨ì˜ ê³¼ì •ì—ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. 

- ë¹„ì˜ì†(new/transient) : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì „í˜€ ê´€ê³„ê°€ ì—†ëŠ” ìƒˆë¡œìš´ ìƒíƒœ
```java
Member member = new Member();
member.setId("member1");
member.setUserName("í™ê¸¸ë™");
```
- ì˜ì†(managed) : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë˜ëŠ” ìƒíƒœ
```java
EntityManager em = EntityManagerFactory.createEntityManger();
em.getTransaction().begin();

Member member = new Member();
member.setId("member1");
member.setUserName("í™ê¸¸ë™");

// ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ (ì˜ì†)
em.persist(member);
```
- ì¤€ì˜ì†(detached) : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì—ˆë‹¤ê°€ ë¶„ë¦¬ëœ ìƒíƒœ
```java
// member ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬ (ì¤€ì˜ì†)
em.detach(member);
```
- ì‚­ì œ(remove) : ì‚­ì œëœ ìƒíƒœ
```java
// ê°ì²´ë¥¼ ì‚­ì œí•œ ìƒíƒœ (ì‚­ì œ)
em.remove(member);
```

### ğŸ’¡ ì˜ì†ì„± ìƒíƒœì˜ íŠ¹ì§• (ì¥ì )
#### ğŸ“Œ 1ì°¨ ìºì‹œ
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì—ëŠ” **1ì°¨ ìºì‹œ**ë¼ê³  ë¶ˆë¦¬ëŠ” ìºì‹œë¥¼ ê°€ì§€ê³  ìˆë‹¤. 
> ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ëª¨ë‘ 1ì°¨ ìºì‹œì— ì €ì¥ë˜ê³ , 1ì°¨ ìºì‹œëŠ” `@Id` ë¥¼ í‚¤ë¡œ ê°€ì§€ê³  ìˆëŠ” Mapì´ ì¡´ì¬í•œë‹¤.
> ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ë°”ë¡œ DBì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³ , 1ì°¨ ìºì‹œì— ìˆëŠ” ë°ì´í„°ë¥¼ ë¨¼ì € ì¡°íšŒí•œ í›„ ì—†ëŠ” ê²½ìš°ì—ë§Œ DBì— ì ‘ê·¼í•˜ì—¬ ì¡°íšŒ í›„ ë‹¤ì‹œ 1ì°¨ ìºì‹œì— ì €ì¥í•œë‹¤. 
> ì¦‰, ë¨¼ì € DBì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ 1ì°¨ ìºì‹œì— ë¨¼ì € ì ‘ê·¼í•¨ìœ¼ë¡œì¨ ë°ì´í„°ì˜ ê²°ê³¼ë¥¼ ë¹ ë¥´ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 
#### ğŸ“Œ ë™ì¼ì„± ë³´ì¥
> ìœ„ íŠ¹ì§•ê³¼ ì—°ê´€ë˜ë©° ëª¨ë“  ì—”í‹°í‹°ì˜ ë°ì´í„°ë“¤ì€ 1ì°¨ ìºì‹œì— ì €ì¥ë˜ì–´ì§€ê¸° ë•Œë¬¸ì— ì‹ë³„ìê°€ ë™ì¼í•œ ì—”í‹°í‹°ì˜ ê²½ìš° ë™ì¼ì„±ì´ ë³´ì¥ëœë‹¤. 
> ì—¬ê¸°ì„œ ë™ì¼ì„±ì´ë€ ê°™ì€ ê°ì²´ë¥¼ ì°¸ì¡°í•œë‹¤ëŠ” ì˜ë¯¸ì´ê³ , í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ê°™ì€ í‚¤ ê°’ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ì—”í‹°í‹° ì¡°íšŒ ì‹œ ê°™ì€ ì—”í‹°í‹° ì¡°íšŒë¥¼ ë³´ì¥í•œë‹¤. 
> ë°”ë¡œ 1ì°¨ ìºì‹œì— ì €ì¥ëœ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê¸° ë•Œë¬¸ì— ê°€ëŠ¥í•œ ì¼ì´ë‹¤.
#### ğŸ“Œ íŠ¸ëœì­ì…˜ì„ ì§€ì—°í•˜ëŠ” ì“°ê¸° ì§€ì—°
> íŠ¸ëœì­ì…˜ì€ DBì—ì„œ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. 
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ DML ì´ ë°œìƒí–ˆì„ ë•Œ ë°”ë¡œ DBì— ì €ì¥í•˜ì§€ ì•Šê³ , íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë  ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ëª¨ì•„ë‘” ì¿¼ë¦¬ë“¤ì„ í•œ ë²ˆì— ì €ì¥í•œë‹¤. 
> ì´ ë•Œ ì¿¼ë¦¬ë“¤ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë”°ë¡œ ì €ì¥ì´ ë˜ë©° ì»¤ë°‹ì„ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ `flush` ë¥¼ í†µí•´ ì¿¼ë¦¬ë“¤ì„ DBì— ì €ì¥í•˜ê²Œ ë˜ê³  ìµœì¢…ì ìœ¼ë¡œ `commit` ì„ í•˜ì—¬ DBì— ì¿¼ë¦¬ë¥¼ ë°˜ì˜í•˜ë‹¤. 
> ì¦‰, DBì— ì ‘ê·¼í•˜ëŠ” íšŸìˆ˜ê°€ ì¤„ì–´ë“¤ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ë©´ì—ì„œ ë›°ì–´ë‚˜ë‹¤. 
#### ğŸ“Œ ë³€ê²½ ê°ì§€
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì—ëŠ” ìŠ¤ëƒ…ìƒ·ì„ í†µí•´ ì—”í‹°í‹°ì˜ ë³€ê²½ì„ ê°ì§€í•œë‹¤. 
> JPAëŠ” 1ì°¨ ìºì‹œì— ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì²˜ìŒ ë¶ˆëŸ¬ì˜¨ ì—”í‹°í‹°ì˜ ìŠ¤ëƒ…ìƒ·ì„ ê°–ê³  ìˆê³ , 1ì°¨ ìºì‹œì— ì €ì¥ëœ ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ·ì„ ë¹„êµí•œ í›„ ë³€ê²½ ë‚´ìš©ì´ ìˆë‹¤ë©´ UPDATE SQLë¬¸ì„ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë‹´ì•„ë‘”ë‹¤. ê·¸ë¦¬ê³  ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë°‹ ì‹œì ì— ë³€ê²½ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ ë°˜ì˜í•œë‹¤.
> ì¦‰, ë”°ë¡œ update ë¬¸ì„ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ë‹¤. ë³€ê²½ê°ì§€ëŠ” ì˜¤ì§ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ì—ë§Œ ì ìš©ì´ ëœë‹¤. 
#### ğŸ“Œ[ì§€ì—° ë¡œë”©ê³¼ ì¦‰ì‹œ ë¡œë”©](obsidian://open?vault=Obsidian&file=Study%2FJava%20%26%20Spring%2F%EC%A7%80%EC%97%B0%20%EB%A1%9C%EB%94%A9%EA%B3%BC%20%EC%A6%89%EC%8B%9C%20%EB%A1%9C%EB%94%A9)

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FQ8I89%2FbtrSaKj07se%2F1eFGjtCBYK4OfduB7xzpKk%2Fimg.png)

- JPA API ì¤‘ì—ì„œ ì—”í‹°í‹° ì •ë³´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•˜ëŠ” APIë¥¼ ì‚¬ìš©í•˜ë©´, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì— ì—”í‹°í‹° ì •ë³´ê°€ ì €ì¥ëœë‹¤. 
```java
// ì—”í‹°í‹°ë¥¼ ìƒì„±í•œ ìƒíƒœ(ë¹„ì˜ì†)
Member member = new Member();
member.setId("member1");
member.setUsername("í™ê¸¸ë™");

// ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥(ì˜ì†)
em.persist(member);
```

### ğŸ’¡ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì¡°íšŒ - `find()`
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ ë°ì´í„°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ì„œëŠ” EntityManagerì˜ `find()` ë©”ì„œë“œë¥¼ í†µí•´ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤. 

#### ğŸ“Œ 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒí•˜ëŠ” ê²½ìš°
```java
Member member = new Member();
member.setId("member1");
member.setName("í™ê¸¸ë™");

em.persist(member);

Member findMember = em.find(Member.class, "member1");
```
- ê°ì²´ë¥¼ ìƒì„±í•œ í›„, `em.persist(member)` ë¥¼ í†µí•´ 1ì°¨ ìºì‹œì— ì €ì¥í•œë‹¤.
- 1ì°¨ ìºì‹œì— ì €ì¥ëœ ìƒíƒœì—ì„œ `find()` ë©”ì„œë“œë¥¼ í†µí•´ ì¡°íšŒí•  ê²½ìš° 1ì°¨ ìºì‹œì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ì¡°íšŒí•œë‹¤. 

#### ğŸ“Œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•˜ëŠ” ê²½ìš°
```java
Member findMember2 = em.find(Member.class, "member2");
```
- `find()` ë©”ì„œë“œëŠ” ë¨¼ì € ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì— ì¡°íšŒí•  ì—”í‹°í‹°ê°€ ì¡´ì¬í•˜ëŠ”ì§€ íƒìƒ‰í•œë‹¤. 
- ë§Œì•½, 1ì°¨ ìºì‹œì— ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ ë’¤, 1ì°¨ ìºì‹œì— ì €ì¥í•œë‹¤.
- ì´í›„ ì¡°íšŒ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤. 

#### ğŸ“Œ ê°™ì€ ë°ì´í„°ë¥¼ 2ë²ˆ ì¡°íšŒí•  ê²½ìš°
```java
Member findMember1 = em.find(Member.class, "member1");
Member findMember2 = em.find(Member.class, "member1");

System.out.println(findMember1 == findMember2);

// ì¶œë ¥
true
```
- ë¨¼ì €, member1ì„ ì°¾ê¸° ìœ„í•´ 1ì°¨ ìºì‹œë¥¼ ì°¾ëŠ”ë‹¤. 
- 1ì°¨ ìºì‹œì— ì¡´ì¬í•˜ì§€ ì•Šì•„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œë‹¤. 
- ì´í›„ 1ì°¨ ìºì‹œì— ì €ì¥í•œ ë’¤ member1ì„ ë°˜í™˜í•œë‹¤. 
- findMember2ê°€ ì‹¤í–‰ë  ë•Œ 1ì°¨ ìºì‹œì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤. 
- findMember1ì— ì˜í•´ 1ì°¨ ìºì‹œì— ì €ì¥ëœ member1ì„ ë°˜í™˜í•œë‹¤. 
- ì¦‰, ê°™ì€ ë°ì´í„°ë¥¼ 2ë²ˆ ì¡°íšŒí•  ê²½ìš° ì¡°íšŒ ì¿¼ë¦¬ëŠ” 1íšŒë§Œ ì‹¤í–‰ëœë‹¤. 

> ë˜í•œ, `findMember1` ê³¼ `findMember2` ë¥¼ ë¹„êµí•˜ë©´, `true` ë¡œ ê°™ì€ ë°ì´í„°ì„ì„ ë‚˜íƒ€ë‚¸ë‹¤. 
> ì´ëŠ” ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„±ì„ ë³´ì¥í•œë‹¤ëŠ” ëœ»ì´ë‹¤. 
##### âœ” 1ì°¨ ìºì‹œì™€ ë™ì¼ì„± ë³´ì¥
1. ê°™ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œëŠ” ê°™ì€ ì—”í‹°í‹°ë¥¼ ë°˜í™˜ - ì•½ê°„ì˜ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
2. DB Isolation Level ì´ Read Commited ì´ì–´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Repeatable Read ë³´ì¥

#### ğŸ“Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ì—”í‹°í‹°ë“¤ì„ ì–´ë–»ê²Œ êµ¬ë¶„í• ê¹Œ ?
> ì—”í‹°í‹° ìƒì„± ì‹œ `@Id` ë¡œ í…Œì´ë¸”ì˜ PK ì™€ ë§¤í•‘í•œ ì‹ë³„ì ê°’ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤. 
> ë”°ë¼ì„œ ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ëŠ” ì‹ë³„ì ê°’ì„ ê°€ì ¸ì•¼ í•œë‹¤. ì‹ë³„ì ê°’ì´ ì—†ë‹¤ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤. 
> ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì˜ í…Œì´ë¸”ê³¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ë‚´ì˜ ì—”í‹°í‹°ê°€ ì¼ì¹˜í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë³´ì—¬ì¤€ë‹¤. 
> ì•„ë˜ì™€ ê°™ì´ `@Id` ë¡œ ë§¤í•‘í•œ ì‹ë³„ìì™€ ì—”í‹°í‹° ì¸ìŠ¤í„´ìŠ¤ ê°’ì„ ê°€ì§€ëŠ” **Map í˜•ì‹**ì„ ê°€ì§„ë‹¤.
> ![img|350](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbbguwy%2FbtsC8YkquRY%2FqMtjsDnLfSk95DX62RKNZ0%2Fimg.png)

##### âœ” ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê°€ì ¸ì˜¤ë©´ ì—°ê´€ ê´€ê³„ì— ìˆëŠ” ì—”í‹°í‹°ëŠ” ì–´ë–»ê²Œ í• ê¹Œ ?

#### ğŸ“Œ ì§€ì—° ë¡œë”©ê³¼ ì¦‰ì‹œ ë¡œë”©
- ì¦‰ì‹œ ë¡œë”© : ì—°ê´€ëœ ì—”í‹°í‹°ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê°™ì´ ì´ë™ì‹œí‚¤ëŠ” ê²ƒ
- ì§€ì—° ë¡œë”© : ì‹¤ì œ ê°ì²´ë¥¼ ìƒì†ë°›ëŠ” **í”„ë¡ì‹œ ê°ì²´** ë¼ëŠ” ê°€ì§œ ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ë™ì‹œí‚¤ëŠ” ê²ƒ. 
	- **í”„ë¡ì‹œì˜ ì´ˆê¸°í™”** : í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹ë³„ì ê°’ê³¼ ë©”ì„œë“œë§Œì„ ê°€ì§€ê³  ìˆê¸°ì— ì‹ë³„ìë¥¼ ì œì™¸í•œ ë‹¤ë¥¸ í•„ë“œ ê°’ì„ ìš”ì²­ì‹œ ì‹¤ì œ ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ë™ì‹œí‚¨ë‹¤. 
> í•„ìš”í•  ë•Œ í•„ìš”í•œ ë¶€ë¶„ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒ
> ![img](https://velog.velcdn.com/images/zxzz45/post/2824d6ad-1d82-458c-8b72-65144d62288e/image.png)


### ğŸ’¡ ì—”í‹°í‹° ë“±ë¡ - ì“°ê¸° ì§€ì—°
- ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ë°ì´í„° ë³€ê²½ ì‹œ ë°˜ë“œì‹œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•´ì•¼ í•œë‹¤. 
```java
EntityManager em = EntityManagerFactory.createEntityManager();
EntityTransaction tx = em.getTransaction; // íŠ¸ëœì­ì…˜

// íŠ¸ëœì­ì…˜ ì‹œì‘
tx.begin();

// ë¹„ì˜ì†
Member member1 = new Member();
member.setId("member1");
member.setName("í™ê¸¸ë™");

Member member2 = new Member();
member.setId("member2");
member.setName("ê³ ê¸¸ë™");

Member member3 = new Member();
member.setId("member3");
member.setName("ê¹€ê¸¸ë™");

// ì˜ì†
em.persist(member1);
em.persist(member2);
em.persist(member3);
// ì—¬ê¸°ê¹Œì§€ INSERT SQLì„ DBì— ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤. 

// ì»¤ë°‹í•˜ëŠ” ìˆœê°„ DBì— INSERT SQLì„ ëª¨ì•„ì„œ ë³´ë‚¸ë‹¤. 
// ì—”í‹°í‹° ë“±ë¡
tx.commit();
```
- `em.persist(member)` : member ì—”í‹°í‹°ë¥¼ ì˜ì† ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•˜ì§€ë§Œ, ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤. 
- `tx.commit()` : íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ëŠ” ìˆœê°„ ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì„ ë³´ë‚´ ì €ì¥í•˜ê²Œ ëœë‹¤. 
- `persist()` ë¥¼ ì‹¤í–‰í•  ë•Œ, ì˜ì† ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì—ëŠ” member ì—”í‹°í‹°ì˜ INSERT SQL ì¿¼ë¦¬ë¬¸ì´ ì €ì¥ëœë‹¤. 
- `tx.commit()` ì„ ì‹¤í–‰í•˜ëŠ” ìˆœê°„ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ì €ì¥ëœ INSERT SQL ì¿¼ë¦¬ë¥¼ ë³´ë‚´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ê²ƒì´ë‹¤. 

> ë”°ë¼ì„œ, ì—¬ëŸ¬ ê°œì˜ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ê³  `persist` ë¥¼ í•˜ë”ë¼ë„, `commit()` ì„ í•˜ê¸° ì „ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.
> ì´ë¥¼ ì“°ê¸° ì§€ì—°ì´ë¼ í•˜ë©°, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì¥ì ì´ë‹¤. 

### ğŸ’¡ ì—”í‹°í‹° ìˆ˜ì • - ë³€ê²½ ê°ì§€
```java
EntityManger em = EntityMangerFactory.createEntityManager();
EntityTransaction tx = em.getTransaction(); // íŠ¸ëœì­ì…˜

// íŠ¸ëœì­ì…˜ ì‹œì‘
tx.begin();

// member ì¡°íšŒ
Member member = em.find(Member.class, "member");
member.setUserName("hello");
member.setAge("20");

// ì—”í‹°í‹° ë“±ë¡
tx.commit();
```
- ì—”í‹°í‹°ì˜ ìˆ˜ì •ì€ `set` ë©”ì„œë“œë¥¼ í†µí•´ì„œ ë³€ê²½í•œ ë’¤, ë³„ë‹¤ë¥¸ ë¡œì§ ì—†ì´ íŠ¸ëœì­ì…˜ ì»¤ë°‹ì„ í•˜ëŠ” ìˆœê°„ì— ì—…ë°ì´íŠ¸ ëœë‹¤. 
- ì´ê²ƒì´ ê°€ëŠ¥í•œ ì´ìœ ëŠ” ë°”ë¡œ **ë³€ê²½ ê°ì§€(Dirty Checking)** ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì´ë‹¤. 
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì—ëŠ” **memberì˜ ì´ˆê¸° ë°ì´í„°** (ìŠ¤ëƒ…ìƒ·) ê°€ ì €ì¥ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤. 
- ì´í›„ `set` ë©”ì„œë“œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ë³€ê²½í•œë‹¤. 
	- set ë©”ì„œë“œëŠ” ë‹¨ìˆœíˆ ë©”ëª¨ë¦¬ì— ìˆëŠ” ì—”í‹°í‹°ì˜ ê°’ì„ ë°”ê¾¸ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, JPAëŠ” ì´ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•œë‹¤. 
- íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ `flush()` ê°€ ë°œìƒí•˜ë©´ì„œ 1ì°¨ ìºì‹œì—ì„œ ì—”í‹°í‹°ì™€ **ìŠ¤ëƒ…ìƒ·**ì„ ë¹„êµí•˜ì—¬ ë³€ê²½ì— ëŒ€í•œ ê°ì§€ë¥¼ í•œë‹¤. 
- ì´í›„ **SQL UPDATE** ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ì—¬ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì—ì„œ ì¿¼ë¦¬ë¥¼ ë³´ë‚¸ë‹¤. 
- ì´ë¡œì¨ DBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê²Œ ëœë‹¤. 

#### ğŸ“Œ ìŠ¤ëƒ…ìƒ·
> ê¸°ë³¸ì ìœ¼ë¡œ JPAëŠ” ì—”í‹°í‹°ì˜ ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•˜ê¸° ìœ„í•´ ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ë” ìµœì í™”í•˜ê¸° ìœ„í•´ íŠ¹ì • ìƒí™©ì—ì„œëŠ” ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆë‹¤. 
> ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì¿¼ë¦¬ì— ëŒ€í•´ `@QueryHint` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì—”í‹°í‹°ë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
> ì´ë ‡ê²Œ í•˜ë©´, ì—”í‹°í‹°ê°€ ìˆ˜ì •ë˜ì§€ ì•Šì„ ê²ƒì´ë¼ê³  JPAì— ì•Œë ¤ì£¼ì–´ ìŠ¤ëƒ…ìƒ·ì„ ì €ì¥í•˜ì§€ ì•Šê²Œ ëœë‹¤. 
```java
@QueryHints(value = @QueryHint(name = "org.hibernate.readOnly", value = "true"))
```

#### ğŸ“Œ ì „ì²´ í•„ë“œ ì—…ë°ì´íŠ¸ vs. ë™ì  ì—…ë°ì´íŠ¸
> ê¸°ë³¸ì ìœ¼ë¡œ JPAëŠ” ì—”í‹°í‹°ë¥¼ ìˆ˜ì •í•  ë•Œ, ì—”í‹°í‹°ì˜ ëª¨ë“  í•„ë“œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤. ì´ëŠ” ìˆ˜ì •ëœ í•„ë“œë§Œ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ëª¨ë“  í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë¯¸ë¦¬ ìƒì„±í•´ë‘ê³ , ì´ ì¿¼ë¦¬ë¥¼ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œì´ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¿¼ë¦¬ë¥¼ ë‹¤ì‹œ íŒŒì‹±í•˜ì§€ ì•Šì•„ë„ ë˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ í–¥ìƒëœë‹¤.
> í•˜ì§€ë§Œ, ë§Œì•½ í•„ë“œê°€ ë§¤ìš° ë§ì€ ì—”í‹°í‹°(ì˜ˆ: 30ê°œ ì´ìƒì˜ í•„ë“œ) ê°€ ìˆì„ ê²½ìš°, ì´ë ‡ê²Œ ëª¨ë“  í•„ë“œë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ì¿¼ë¦¬ëŠ” ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤. ì´ ë•ŒëŠ” `@DynamicUpdate` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬, ì‹¤ì œë¡œ ë³€ê²½ëœ í•„ë“œë§Œì„ í¬í•¨í•˜ëŠ” `UPDATE` ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë°ì´í„° ì „ì†¡ëŸ‰ì´ ì¤„ì–´ë“¤ê³  ì„±ëŠ¥ì´ í–¥ìƒë  ìˆ˜ ìˆë‹¤.
```java
@DynamicUdpate
public class User {
	// ì—”í‹°í‹° í•„ë“œë“¤...
}
```

### ğŸ’¡ ì—”í‹°í‹° ì‚­ì œ
```java
Member member = em.find(Member.class, "member");
em.remove(member); // ì—”í‹°í‹° ì‚­ì œ
```
- ì—”í‹°í‹° ì‚­ì œëŠ” `remove()` ë©”ì„œë“œë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë‘ ì œê±°ëœë‹¤. 

#### ğŸ“Œ `deleteById()` 
> ê°„í˜¹ ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ í†µí•´ `deleteById()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ë§¤ê°œ ë³€ìˆ˜ë¡œ idë§Œì„ "ìš”êµ¬í•˜ëŠ” ê²ƒì„ ë³´ê³  ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ì§€ ì•Šì•„ë„ ëœë‹¤." ë¼ê³  ì˜¤í•´í•  ìˆ˜ë„ ìˆëŠ”ë°, 
> ë©”ì„œë“œë¥¼ ë³´ë©´ ë‚´ë¶€ì—ì„œ `findById()` ë¥¼ ì‹œí–‰ í›„ `delete()` ë©”ì„œë“œë¥¼ ì‹¤ì‹œí•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. 
```java
@Transactional
public void deleteById(ID id) {
	Assert.notNull(id, "The given id must not be null!");
	this.delete(this.findById(id).orElseThrow(() -> {
		return new EmptyResultDataAccessException(String.format("No %s entity with id %s exists!", this.entityInformation.getJavaType(), id), 1);	
	}));
}

@Transactional
public void delete(T entity) {
	Assert.notNull(entity, "Entity must not be null!);
	if (!this.entityInformation.isNew(entity)) {
		Class<?> type = ProxyUtils.getUserClass(entity);
		
		T existing = this.em.find(type, this.entityInformation.getId(entity));
		if (existing != null) {
			this.em.remove(this.em.contains(entity) ? entity : this.em.merge(entity));
		}
	}
}
```
- `delete` ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©´ `em.remove` ê°€ ì‹¤í–‰ë˜ëŠ”ë°, ì´ëŠ” ì—”í‹°í‹° ì €ì¥, ìˆ˜ì •ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì‚­ì œ ì¿¼ë¦¬ë¥¼ ë°”ë¡œ ë³´ë‚´ì§€ ì•Šê³  **ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë“±ë¡**í•œë‹¤. 
- ë¬¼ë¡  1ì°¨ ìºì‹œì— ìˆëŠ” ì—”í‹°í‹°ëŠ” ì œê±°ëœë‹¤. 

### ğŸ’¡ í”ŒëŸ¬ì‹œ - `flush()`
> íŠ¸ëœì­ì…˜ ì»¤ë°‹ì„ ì‹¤í–‰í•˜ë©´ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ê²Œ ëœë‹¤. 
> íŠ¸ëœì­ì…˜ ì»¤ë°‹ì´ ì¼ì–´ë‚  ë•Œ í”ŒëŸ¬ì‹œë„ í•¨ê»˜ ë°œìƒí•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. 
> ì¦‰, í”ŒëŸ¬ì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ê²ƒì´ë‹¤. 

- **í”ŒëŸ¬ì‹œ ë°œìƒ ì‹œ** 
	- ë³€ê²½ ê°ì§€ (Dirty Checking)
	- ìˆ˜ì •ëœ ì—”í‹°í‹° ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë“±ë¡
	- ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì˜ ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ì†¡ (ë“±ë¡, ìˆ˜ì •, ì‚­ì œ ì¿¼ë¦¬)
- **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œ í•˜ëŠ” ë°©ë²•**
	- `em.flush()` ì§ì ‘ í˜¸ì¶œ (í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©)
	- `tx.commit()` íŠ¸ëœì­ì…˜ ì»¤ë°‹ì„ í†µí•œ ìë™ í˜¸ì¶œ
	- JPQL ì¿¼ë¦¬ ì‹¤í–‰ - í”ŒëŸ¬ì‹œ ìë™ í˜¸ì¶œ

- **ì§ì ‘ í˜¸ì¶œ ì˜ˆì‹œ**
```java
Member member = new Member(200L, "member200");
em.persist(member);

em.flush(); // ê°•ì œ í˜¸ì¶œ
System.out.println("-------------");

tx.commit();
```
- `flush()` ëŠ” ë³€ê²½ì„ ê°ì§€í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤. 
- ë”°ë¼ì„œ ì´í›„ì— `commit()` ì´ ë°œìƒí•´ë„ ì¿¼ë¦¬ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. 
- ë˜í•œ, `flush()` ë¥¼ í•œë‹¤ê³  í•´ì„œ 1ì°¨ ìºì‹œì˜ ë‚´ìš©ì´ ì‚¬ë¼ì§€ì§€ ì•ŠëŠ”ë‹¤. 

- **JPQL ì¿¼ë¦¬ ì‹¤í–‰ ì‹œ í”ŒëŸ¬ì‹œê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ì´ìœ ** 
```java
em.persist(memberA);
em.persist(memberB);
em.persist(memberC);

// ì¤‘ê°„ì— JPQL ì‹¤í–‰
query = em.createQuery("select m from Member m", Member.classs);
List<Member> members = query.getResultList();
```
> ìœ„ ì½”ë“œì™€ ê°™ì´ `persist()` ë¥¼ ì‹¤í–‰í•œ ë’¤, JPQLë¡œ ì¿¼ë¦¬ë¥¼ ë³´ë‚´ë©´ membersì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ì—†ì„ ê²ƒì´ë‹¤.
> ì¿¼ë¦¬ ë°œìƒ ì´ì „ì— ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” `flush()` ê°€ í˜¸ì¶œë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. 
> ì§ì ‘ í”ŒëŸ¬ì‹œë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, ì¿¼ë¦¬ ì´ì „ì— `commit()` ì„ í•´ì•¼ í•œë‹¤. 
> ì´ëŸ¬í•œ ë¬¸ì œì ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì¤‘ê°„ì— JPQLì´ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ ìë™ìœ¼ë¡œ í”ŒëŸ¬ì‹œë¥¼ í˜¸ì¶œí•˜ì—¬ JPQL ì¿¼ë¦¬ë¥¼ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. 

#### ğŸ“Œ í”ŒëŸ¬ì‹œ ì˜µì…˜ ëª¨ë“œ
- `FlushModeType.AUTO` : (ê¸°ë³¸ ê°’) ì»¤ë°‹ì´ë‚˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ í”ŒëŸ¬ì‹œ
- `FlushModeType.COMMIT` : ì»¤ë°‹í•  ë•Œë§Œ í”ŒëŸ¬ì‹œ
```java
em.setFlushMode(FlushModeType.COMMIT);
```
> ì»¤ë°‹ì´ë‚˜ JPQL ì¿¼ë¦¬ ë“±ì„ ì‹¤í–‰í•  ë•Œ ìë™ìœ¼ë¡œ í”ŒëŸ¬ì‹œ ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ í”ŒëŸ¬ì‹œ ëª¨ë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
> ë³€ê²½ëœ ê²ƒê³¼ëŠ” ì•„ë¬´ëŸ° ê´€ë ¨ì´ ì—†ëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì— ì¿¼ë¦¬ë¥¼ ë³´ë‚´ê³ ì í•  ë•Œ ì¢…ì¢… ì‚¬ìš©ëœë‹¤. 

#### ğŸ“Œ í”ŒëŸ¬ì‹œì— ëŒ€í•œ ì˜¤í•´
- í”ŒëŸ¬ì‹œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš°ì§€ ì•ŠëŠ”ë‹¤. 
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë™ê¸°í™”í•˜ëŠ” ì—­í• ì´ë‹¤. 
- í”ŒëŸ¬ì‹œì˜ ê°œë…ì€ íŠ¸ëœì­ì…˜ì´ë¼ëŠ” ì‘ì—… ë‹¨ìœ„ì— ì¤‘ìš”í•˜ë‹¤.
	- ì»¤ë°‹ ì§ì „ì—ë§Œ ë™ê¸°í™”í•˜ë©´ ëœë‹¤. 

### ğŸ’¡ ì¤€ì˜ì† ìƒíƒœ
> `em.persist()` ë˜ëŠ” `em.find()` ë¥¼ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ ë°ì´í„°ëŠ” ì˜ì† ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ë˜ì–´ ì˜ì† ìƒíƒœê°€ ëœë‹¤. 
> ì¤€ì˜ì† ìƒíƒœì—ì„œëŠ” ì˜ì† ìƒíƒœì˜ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¶„ë¦¬(detached) ëœ ìƒíƒœë¥¼ ë§í•œë‹¤. 
> ì¤€ì˜ì† ìƒíƒœì—ì„œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê²Œëœë‹¤. 

#### ğŸ“Œ ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“œëŠ” ë°©ë²•
- `em.detach(entity)` : íŠ¹ì • ì—”í‹°í‹°ë§Œ ì¤€ì˜ì† ìƒíƒœë¡œ ë³€í™˜
- `em.clear()` : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì™„ì „íˆ ì´ˆê¸°í™”
- `em.close()` : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œ

---
### ğŸ’¡ [JPA `save()` ë©”ì„œë“œì˜ ë™ì‘ ë°©ë²•](https://khdscor.tistory.com/110)
##### âœ” `repository.save()` ë¥¼ í•  ê²½ìš° INSERT ë¬¸ì€ íŠ¸ëœì­ì…˜ì´ ëë‚¬ì„ ë•Œ ì‹¤í–‰ë í…ë° ì–´ë–»ê²Œ ë°˜í™˜í•˜ëŠ” ê°ì²´ì— PK ê°€ ìˆëŠ” ê²ƒì¸ê°€ !?!??!! 
- **ê²°ë¡ **
	- `@GeneratedValue(strategy = GenerationType.IDENTITY) // auto-increment`
	- ìœ„ ì–´ë…¸í…Œì´ì…˜ì€ JPAì—ì„œ IDENTITY ì „ëµì„ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ í‚¤ë¥¼ ìë™ ìƒì„±í•˜ê² ë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•˜ëŠ” ê²ƒ. 
> ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ **'ì“°ê¸° ì§€ì—°'** ê¸°ëŠ¥ ë•ë¶„ì— íŠ¸ëœì­ì…˜ì´ ëë‚˜ì•¼ INSERTê°€ ë˜ëŠ”ë° í•˜ë‚˜ì˜ ë©”ì„œë“œì—ì„œ `repository.save()` ë¥¼ í–ˆì„ ë•Œ ì–´ë–»ê²Œ ë°˜í™˜ ê°’ìœ¼ë¡œ PK ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ”ì§€ ìƒê°í•´ë³´ì. 
> ì •ë‹µì€ **IDENTITY ì „ëµ**ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤. 
> ì—”í‹°í‹°ëŠ” ì˜ì† ìƒíƒœê°€ ë˜ë ¤ë©´ **ì‹ë³„ì ê°’ì´ ë¬´ì¡°ê±´ í•„ìš”**í•˜ë‹¤. (DBì™€ ë™ê¸°í™” ì‹œì¼œì•¼ í•˜ê¸° ë•Œë¬¸) ê²°êµ­ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì‹ë³„ì ê°’ì´ ìˆëŠ” ìƒíƒœë¡œ ì—”í‹°í‹°ê°€ ì¡´ì¬í•˜ê¸° ìœ„í•´ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— í•œ ë²ˆ ì €ì¥ í›„ ë‹¤ì‹œ ê°€ì ¸ì™€ì•¼ í•œë‹¤. 
> ì´ë ‡ë“¯ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œëŠ” IDENTITY ì „ëµìœ¼ë¡œ ì—”í‹°í‹° ìƒì„± ë©”ì„œë“œë¥¼ í˜¸ì¶œ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ì— INSERT SQLì´ ì¦‰ì‹œ ì „ë‹¬ì´ ëœ í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤. 
> **ë”°ë¼ì„œ ì´ ì „ëµì€ ì“°ê¸° ì§€ì—°ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.** 

```java
@Transactional
@Override
public <S extends T> S save(S entity) {

	Assert.notNull(entity, "Entity must not be null.");

	if (entityInformation.isNew(entity)) { // 1
		// IDENTITY ì „ëµ ì‹œ persist ë¥¼ í•˜ê²Œ ë˜ë©´ í˜¸ì¶œ ì¦‰ì‹œ INSERT ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ë©°, IDê°€ í• ë‹¹ë¨ 
		em.persist(entity); // 2
		return entity; // 3
	} else { // 4
		return em.merge(entity); // 5
	}
}
```

##### âœ” IDENTITY ì „ëµì„ ëª…ì‹œí•˜ì§€ ì•Šì„ ê²½ìš°
- IDENTITY ì „ëµì„ ëª…ì‹œí•˜ì§€ ì•Šê³ , JPAì—ì„œ ìë™ìœ¼ë¡œ ì „ëµì„ ì„ íƒí•˜ë„ë¡ ë‘ë©´, ì‚¬ìš© ì¤‘ì¸ ë°ì´í„° ë² ì´ìŠ¤ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•  ìˆ˜ ìˆë‹¤. 
- - `IDENTITY`, `SEQUENCE`, `TABLE`, `AUTO` 

1. MYSQL
	- `GenerationType.AUTO` ê°€ `IDENTITY` ë¡œ ë™ì‘í•˜ì—¬, `INSERT` ì¿¼ë¦¬ê°€ `persist` í˜¸ì¶œ ì‹œì ì— ì¦‰ì‹œ ì‹¤í–‰ë˜ì–´ IDê°€ í• ë‹¹ëœë‹¤. 
2. Oracle 
	- `SEQUENCE` ì „ëµìœ¼ë¡œ ë™ì‘ëœë‹¤. ì´ ê²½ìš° ì‹œí€€ìŠ¤ë¥¼ í†µí•´ ë¯¸ë¦¬ IDë¥¼ í• ë‹¹ë°›ê³ , ì´í›„ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë  ë•Œ `INSERT` ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤. 

##### âœ” [@Idê°€ @GeneratedValueê°€ ì•„ë‹Œ ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥ì„ ë°›ëŠ” ë³€ìˆ˜ì¼ ê²½ìš°](https://wangtak.tistory.com/2)

---
### ğŸ’¡ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ì–´ë””ê¹Œì§€ ìœ ì§€ë˜ëŠ”ê°€
https://woo-chang.tistory.com/65
