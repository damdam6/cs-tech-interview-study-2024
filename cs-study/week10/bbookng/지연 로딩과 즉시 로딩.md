# ì§€ì—° ë¡œë”©ê³¼ ì¦‰ì‹œ ë¡œë”©

JPAì—ì„œëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì¦‰ì‹œ ë¡œë”©(EAGER)ê³¼ ì§€ì—° ë¡œë”©(LAZY) ë‘ ê°€ì§€ ë°©ì‹ì´ ìˆë‹¤. ì´ ë‘ ê°€ì§€ ë°©ì‹ì„ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´ ì¦‰ì‹œ ë¡œë”©ì€ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ ë°ì´í„°ê¹Œì§€ í•œ ë²ˆì— ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ê³ , ì§€ì—° ë¡œë”©ì€ í•„ìš”í•œ ì‹œì ì— ì—°ê´€ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

### ğŸ’¡ Fetch Typeì´ë€

FetchTypeì´ë€, JPAê°€ í•˜ë‚˜ì˜ Entityë¥¼ ì¡°íšŒí•  ë•Œ, ì—°ê´€ê´€ê³„ì— ìˆëŠ” ê°ì²´ë“¤ì„ ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ ê²ƒì´ëƒë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì„¤ì •ê°’ì´ë‹¤.

JPAëŠ” ORM ê¸°ìˆ ë¡œ, ì‚¬ìš©ìê°€ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³ , JPAì—ì„œ JPQLì„ ì´ìš©í•˜ì—¬ ì¿¼ë¦¬ë¬¸ì„ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ê°ì²´ì™€ í•„ë“œë¥¼ ë³´ê³  ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤.  
ë”°ë¼ì„œ, ë‹¤ë¥¸ ê°ì²´ì™€ ì—°ê´€ê´€ê³„ ë§¤í•‘ì´ ë˜ì–´ìˆìœ¼ë©´ ê·¸ ê°ì²´ë“¤ê¹Œì§€ ì¡°íšŒí•˜ê²Œ ë˜ëŠ”ë°, ì´ë•Œ ì´ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ë¶ˆëŸ¬ì˜¬ ê²ƒì¸ê°€ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

fetchì˜ ë””í´íŠ¸ ê°’ì„ @xxToOneì—ì„œëŠ” EAGER, @xxToManyì—ì„œëŠ” LAZYì´ë‹¤.

### ğŸ’¡ í”„ë¡ì‹œ(Proxy) ë€?
> íŠ¹ì • ê°ì²´ë¥¼ í˜¸ì¶œí•˜ë ¤ê³  í•  ë•Œ í•´ë‹¹ ê°ì²´ì— ì§ì ‘ ìš”ì²­í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì¤‘ê°„ì— Proxyê°ì²´ (ê°€ì§œ) ë¥¼ ë‘ì–´ Proxy ê°ì²´ê°€ ëŒ€ì‹  ìš”ì²­ì„ ë°›ì•„ ì‹¤ì œ ê°ì²´ë¥¼ í˜¸ì¶œí•´ ì£¼ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. 

í”„ë¡ì‹œ íŒ¨í„´ì„ ì“°ëŠ” ì¼ë°˜ì ì¸ ì´ìœ ëŠ” **ì ‘ê·¼ì„ ì œì–´**í•˜ê³  ì‹¶ê±°ë‚˜, **ë¶€ê°€ ê¸°ëŠ¥ì„ ì¶”ê°€**í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤. 

#### ğŸ“Œ Proxyì˜ íŠ¹ì§•
- í”„ë¡ì‹œëŠ” **ì‹¤ì œ ê°ì²´ë¥¼ ìƒì†** ë°›ì•„ ë§Œë“¤ì–´ì§€ë©°, ì‚¬ìš©ìëŠ” í”„ë¡ì‹œ ê°ì²´ì¸ì§€ ì‹¤ì œ ê°ì²´ì¸ì§€ êµ¬ë¶„í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. 
- í”„ë¡ì‹œ ê°ì²´ëŠ” **ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë¥¼ ë³´ê´€**í•˜ë©°, í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤. 
![img](https://velog.velcdn.com/images/bagt/post/206a9736-8f30-41b9-aa2d-6cc8d4fb4bd3/image.png)
> - í”„ë¡ì‹œ ê°ì²´ëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ **í•œ ë²ˆë§Œ ì´ˆê¸°í™”**ëœë‹¤.
> - í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ê¸° ë•Œë¬¸ì—, **íƒ€ì… ì²´í¬ ì‹œ** `==` ëŒ€ì‹  `instance of` ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. 
> - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” **ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ ë¬¸ì œê°€ ë°œìƒí•œë‹¤.**
> 	- Hibernate ê°€ `org.hibernate.LazyInitializationExceiption` ì„ í„°íŠ¸ë¦°ë‹¤. 




### ğŸ’¡ ì¦‰ì‹œë¡œë”©(Eager)

ì¦‰ì‹œë¡œë”©ì´ë€ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ, ì—°ê´€ëœ ëª¨ë“  ê°ì²´ì˜ ë°ì´í„°ê¹Œì§€ í•œ ë²ˆì— ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ë‹¤.

- `xxToxx(fetch = fetchType.EAGER)`
- ë‹¤ìŒê³¼ ê°™ì´ Member ì—”í‹°í‹°ì™€ Team ì—”í‹°í‹°ê°€ N:1 ë§¤í•‘ìœ¼ë¡œ ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤.

```java
@Entity
public class Member {

    @Id @GeneratedValue
    private Long id;
    private String username;

    @ManyToOne(fetch = FetchType.EAGER) //Teamì„ ì¡°íšŒí•  ë•Œ ì¦‰ì‹œë¡œë”©ì„ ì‚¬ìš©í•˜ê³˜ë‹¤!
    @JoinColumn(name = "team_id")
    Team team;
}

@Entity
public class Team {

    @Id @GeneratedValue
    private Long id;
    private String teamname;
}
```

- JPQLë¡œ Member 1ê±´ ì¡°íšŒ

```java
Member findMember = em.createQuery("select m from Member m", Member.class).getSingleResult();
```

- ì‹¤ì œ SQL ì½”ë“œ

```sql
//ë©¤ë²„ë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬
select
    member0_.id as id1_0_,
    member0_.team_id as team_id3_0_,
    member0_.username as username2_0_ 
from
    Member member0_

//íŒ€ì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬
select
    team0_.id as id1_3_0_,
    team0_.name as name2_3_0_ 
from
    Team team0_ 
where
    team0_.id=?
```

ë‹¤ìŒê³¼ ê°™ì´ ì¦‰ì‹œ ë¡œë”©(EAGER) ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ Member ì¡°íšŒí•˜ëŠ” ì‹œì ì— ë°”ë¡œ Teamê¹Œì§€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ í•œêº¼ë²ˆì— ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

### ğŸ’¡ ì§€ì—°ë¡œë”©(Lazy)

ì§€ì—°ë¡œë”©ì´ë€, í•„ìš”í•œ ì‹œì ì— ì—°ê´€ëœ ê°ì²´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒì´ë‹¤.

- `@xxToxx(fetch = fetchType.LAZY)`
- ìœ„ì˜ ì˜ˆì œì—ì„œ FetchTypeë§Œ Lazyë¡œ ë°”ê¿”ì„œ ì‹¤í–‰

```java
@ManyToOne(fetch = FetchType.LAZY) //Teamì„ ì¡°íšŒí•  ë•Œ ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•˜ê³˜ë‹¤!
```

- JPQLë¡œ Member ì¡°íšŒ

```java
Member findMember = em.createQuery("select m from Member m", Member.class).getSingleResult();
```

- ì‹¤ì œ SQL ì½”ë“œ

```sql
//Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•ŠìŒ!
select
    member0_.id as id1_0_,
    member0_.team_id as team_id3_0_,
    member0_.username as username2_0_ 
from
    Member member0_
```

ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ë©´ Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì‹œì ì´ ì•„ë‹Œ ì‹¤ì œ Teamì„ ì‚¬ìš©í•˜ëŠ” ì‹œì ì— ì¿¼ë¦¬ê°€ ë‚˜ê°€ë„ë¡ í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

ìœ„ ì˜ˆì œì˜ ì¦‰ì‹œ ë¡œë”©ì—ì„œëŠ” memberì™€ ì—°ê´€ëœ Teamì´ 1ê°œì—¬ì„œ Teamì„ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ê°€ ë‚˜ê°”ì§€ë§Œ, ë§Œì•½ Memberë¥¼ ì¡°íšŒí•˜ëŠ” JPQLì„ ë‚ ë ¸ëŠ”ë° ì—°ê´€ëœ Teamì´ 1000ê°œë¼ë©´? Memberë¥¼ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ë¥¼ í•˜ë‚˜ ë‚ ë ¸ì„ ë¿ì¸ë° Teamì„ ì¡°íšŒí•˜ëŠ” SQL ì¿¼ë¦¬ 1000ê°œê°€ ì¶”ê°€ë¡œ ë‚˜ê°€ê²Œ ëœë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ê°€ê¸‰ì ì´ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.