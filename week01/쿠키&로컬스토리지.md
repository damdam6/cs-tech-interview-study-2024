# 쿠키? 로컬스토리지?

## 🍪 쿠키

- 개념
  : 사용자의 웹 브라우저에 저장되는 작은 기록 정보 파일

  - 최대 4KB를 가진 매우 작은 양의 데이터로, 방문한 페이지를 저장하거나 유저의 `로그인 정보`를 저장하는 등 다양한 방법으로 사용됨.
  - 문자열(text)만 저장이 가능하다는 제한이 있음.
  - (key, value) 형태로 저장되어 있음.
  - 브라우저 전용 쿠키 저장소에 저장됨.

- 쿠키는 왜 사용하는걸까?

  - 사용자 경험을 높여주기 위해
  - HTTP의 stateless을 보완하기 위해 등장했음.
  - 쿠키를 활용해서 `서버`는 사용자의 브라우저에 데이터를 넣을 수 있음.
  - 반복적인 인증(stateless하기 때문에 서버는 클라이언트가 누구인지 계속 인증을 해주어야 하기 때문)을 피해 사용자 편의를 위한 기능을 제공하기 위해서 사용함.
  - 쿠키는 자동으로 모든 요청에 함께 담겨서 날아간다.

- 특징

  1. 쿠키는 브라우저 단위로 생성됨.
  2. 쿠키는 도메인에 따라 제한이 됨. `ex) youtube에서 생성한 쿠키는 youtube에만 보내짐.`

- 쿠키의 취약점

  1. XSS(Cross Site Scripting) <br/>
     JS에서 `document.cookie`라는 명령어를 활용해 쿠키 탈취 가능
  2. 스니핑<br/>
     패킷을 가로채 정보 도청 가능
  3. CSRF(Cross-Site Request Forgey)<br/>
     사용자의 의지와 무관하게 공격자가 의도한 행동을 하도록 만드는 공격

- 어떻게 보안을 강화할 수 있을까?

  1. Secure: HTTPS 연결을 통해서만 전송됨. 즉, 암호화 되어 전송
  2. HttpOnly: 웹 서버에서만 액세스할 수 있음.
     -> 하지만 위 방법도 보안이 완벽하지는 않다.
  3. SameSite: 외부 서비스에서 우리 서비스의 데이터를 변경하는 요청을 보내지 못하게 만듦.

  ### 궁금증

  ```
  Q) youtube에서 생성한 쿠키는 youtube에만 보내진다고 했는데 그럼 CSRF에 안전한거 아닌가? 왜 SameSite설정을 해줘야하지?

  A) 쿠키에서 CSRF공격이 취약한 것은 쿠키에 담긴 액세스를 탈취해오기 때문이 아니라 통신 시 쿠키가 자동으로 서버로 같이 넘어가기 때문에 이를 통해 서버의 민감한 정보를 수정할 수 있기 때문임. 기본 설정은 `Lax`로 일부 예외(`HTTP GET method/a href/link href`)에서는 CSRF가 발생할 가능성이 있음.
  ```

## 🫙 로컬스토리지

- 클라이언트측에서 데이터를 저장하는데 사용됨.
- 5MB이상의 데이터를 저장할 수 있어 비교적 큰 데이터도 저장가능
- 사용자의 브라우저에 데이터를 저장하는 방법 중 하나
- 웹 스토리지 DB에 저장됨.

- 쿠키와 다른 점이 뭘까?

  1. 모든 HTTP요청에 데이터를 주고 받을 필요가 없음.
  2. 문자열 뿐만 아니라 object도 저장이 가능함.
  3. 영구저장(수동 삭제 필요, 하지만 이는 쿠키에 만료시간이 있다고 가정했을 경우)

- 특징

  - 로컬스토리지 또한 도메인별로 저장됨.

- 로컬스토리지의 취약점

  - XSS 공격에 취약함.
  - 암호화가 되지 않음.

- 로컬스토리지에는 주로 어떤 데이터가 저장이 될까?
  - 언어 설정
  - 팝업 설정 정보(ex. 일주일간 보지 않기)

### 궁금증

```
Q) 언어 설정과 팝업 설정 정보와 같은 데이터는 쿠키에 저장해도 되는거 아닌가?
A) 쿠키에 저장해도 무방하다. 하지만 쿠키의 저장소는 로컬스토리지보다 작으며 쿠키는 모든 HTTP요청에 포함되어 가므로 HTTP요청에 필요한 내용이 아니라면? 굳이 라는 생각을 한다...
```

## 결론

- 쿠키와 로컬 스토리지의 차이

  - 데이터 전달 방식: 쿠키는 HTTP요청에 자동으로 포함되지만 로컬 스토리지는 임의로 포함해야 포함됨.
  - 생성 장소: 쿠키는 서버에서 생성, 로컬스토리지에는 클라이언트측에서 저장(?)생성(?)
  - 브라우저 정책: 쿠키는 개인정보 보호 모드 시 자동 차단, 로컬스토리지는 동일 도메인에서 항상 접근 가능

- 쿠키와 로컬 스토리지의 공통점
  - 둘다 웹 브라우저에 저장된다는 점은 동일함.
    (하지만 내부 저장소 구조와 동작 메커니즘이 다름!!! <br/>
    )

---

[쿠키의 SameSite 설명1](https://web.dev/articles/samesite-cookies-explained?hl=ko) <br/>
[쿠키의 SameSite 설명2](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions) <br/>
